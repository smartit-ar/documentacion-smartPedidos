<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notas de Release: Backoffice 6.3.0 - Dashboard de Latencias</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />

    <style>
        /* Importación de Fuentes de Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Fira+Code:wght@400&display=swap');

        /* Variables CSS para la Paleta de Colores */
        :root {
            --bg-color: #f4f7f9;
            --card-bg-color: #ffffff;
            --text-color: #212529;
            --text-muted-color: #6c757d;
            --border-color: #dee2e6;
            --primary-color: #0056b3;
            --analysis-bg: #e6f7ff;
            --analysis-border: #91d5ff;
            --deployment-bg: #f0fdf4;
            --deployment-border: #86efac;
        }

        /* Estilos Base */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 2em;
            line-height: 1.7;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
        }

        /* Encabezado Principal */
        .main-header {
            background-color: var(--card-bg-color);
            padding: 2em;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin-bottom: 2.5em;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .main-header h1 {
            margin: 0 0 0.25em 0;
            font-size: 2.2em;
            color: var(--primary-color);
        }

        .main-header p {
            margin: 0;
            font-size: 1.1em;
            color: var(--text-muted-color);
        }

        /* Información de Despliegue */
        .deployment-info-box {
            background-color: var(--deployment-bg);
            border-left: 4px solid var(--deployment-border);
            padding: 1em 1.5em;
            margin-bottom: 2.5em;
            border-radius: 4px;
        }

        .deployment-info-box h4 {
            margin-top: 0;
            font-size: 1.2em;
            color: #166534;
        }

        .deployment-info-box p {
            margin: 0.5em 0 0 0;
            font-family: 'Fira Code', monospace;
            font-size: 0.95em;
        }

        /* Secciones de Servicio */
        .service-section {
            margin-bottom: 3em;
        }

        .service-section>h2 {
            font-size: 1.8em;
            color: var(--primary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5em;
            margin-bottom: 1.5em;
        }

        /* Tarjeta de Componente (details) */
        .component-card {
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 2em;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        /* Encabezado de la Tarjeta (summary) */
        .component-header {
            padding: 1em 1.5em;
            background-color: #fafafa;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            list-style: none; /* Oculta el marcador de triángulo por defecto */
        }

        /* Oculta el marcador de triángulo en WebKit (Chrome/Safari) */
        .component-header::-webkit-details-marker {
            display: none;
        }

        .component-header h3 {
            margin: 0;
            font-family: 'Fira Code', monospace;
            font-size: 1.2em;
        }

        /* Cuerpo de la Tarjeta */
        .component-body {
            padding: 1.5em;
        }

        .component-body h4 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            font-size: 1.2em;
            color: #343a40;
        }

        .component-body h5 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            font-size: 1.1em;
            font-weight: 700;
        }

        /* Caja de Conclusión del Análisis */
        .analysis-box {
            background-color: var(--analysis-bg);
            border-left: 4px solid var(--analysis-border);
            padding: 1em 1.5em;
            margin-top: 1.5em;
            border-radius: 4px;
        }

        .analysis-box h4 {
            margin-top: 0;
            font-size: 1.1em;
            color: var(--primary-color);
        }

        /* Bloques de Código (Prism.js) */
        pre[class*="language-"] {
            padding: 1.2em !important;
            margin: 1em 0 !important;
            border-radius: 6px;
            font-family: 'Fira Code', monospace !important;
            font-size: 0.9em !important;
            line-height: 1.5 !important;
            border: 1px solid var(--border-color);
            /* CRÍTICO: Ajuste de código para evitar el scroll horizontal */
            white-space: pre-wrap;
            word-break: break-all;
        }
    </style>
</head>

<body>

    <div class="container">
        <header class="main-header">
            <h1>Notas de Release: Backoffice 6.3.0</h1>
            <p>
                Implementación del Dashboard de Latencias y capacidades de graficación avanzada.
            </p>
        </header>

        <div class="deployment-info-box">
            <h4>Información de Despliegue</h4>
            <p><b>Versión:</b> 6.3.0</p>
            <p><b>Fecha de Despliegue:</b> 20/01/2026</p>
            <p><b>Commits:</b> d2f7cfb</p>
        </div>

        <section id="summary" class="service-section">
            <h2>Resumen General de la Versión</h2>
            <p>
                Esta versión introduce una solución completa de Business Intelligence (BI) para la visualización de métricas de rendimiento. Se habilita la graficación avanzada mediante ApexCharts y se despliega un nuevo módulo "Latencias" que transforma datos crudos de timestamps en gráficos de barras apiladas, permitiendo el análisis detallado de los tiempos de procesamiento en cada etapa del ciclo de vida de la orden.
            </p>
        </section>

        <section id="technical-analysis" class="service-section">
            <h2>Análisis Técnico Detallado</h2>

            <!-- Bloque para Configuración -->
            <details class="component-card" open>
              <summary class="component-header">
                <h3>Configuración y Dependencias (app/angular.json, package.json)</h3>
              </summary>
              <div class="component-body">
                  <h4>Análisis General</h4>
                  <p>
                    Se habilita la capacidad de graficación avanzada mediante la inclusión de <code>apexcharts</code> y su wrapper para Angular.
                  </p>
                  
                  <h4>Cambios Detallados</h4>
            
                  <h5>Inyección de Scripts Globales</h5>
                  <p><b>Explicación:</b> Se añade el script base de ApexCharts al array global en <code>angular.json</code> para asegurar que las funcionalidades de la librería estén disponibles en toda la aplicación.</p>
                  <b>Código Nuevo:</b>
                  <pre><code class="language-json">
"scripts": [
  "node_modules/bootstrap/dist/js/bootstrap.min.js",
  "node_modules/apexcharts/dist/apexcharts.min.js" // Nuevo script global
]
                  </code></pre>
              </div>
            </details>

            <!-- Bloque para Latencias Component Logic -->
            <details class="component-card" open>
              <summary class="component-header">
                <h3>app/src/app/pages/monitoring/latencias/latencias.component.ts</h3>
              </summary>
              <div class="component-body">
                  <h4>Análisis General</h4>
                  <p>
                    Componente encargado de la lógica de negocio del dashboard. Transforma los datos crudos del backend en métricas de duración y las agrupa por hora para alimentar el gráfico. Destaca por realizar el pre-procesamiento matemático en el cliente.
                  </p>
                  
                  <h4>Cambios Detallados</h4>
            
                  <h5>Lógica de Procesamiento y Agrupación</h5>
                  <p><b>Explicación:</b> Se calculan las diferencias de tiempo (<code>diffMs</code>) entre cada hito (ej. responseDate - entryDate) y se agrupan en "buckets" horarios. Finalmente, se mapean estos promedios a las series que espera ApexCharts.</p>
                  <b>Código Nuevo:</b>
                  <pre><code class="language-typescript">
// Agrupación y cálculo de promedios
      result.forEach(orderTime => {
        // ...
        b['platformDate-entryDate'] += this.diffMs(
          orderTime.latencyTimestamp.platformDate,
          orderTime.latencyTimestamp.entryDate
        );
        // ... (cálculo para otras etapas) ...
      });
      
      // Transformación a series para ApexCharts
      const series = [
        {
          name: 'platformDate-entryDate',
          data: categories.map(k =>
            buckets[k].count
              ? buckets[k]['platformDate-entryDate'] / buckets[k].count // Promedio
              : 0
          )
        },
        // ...
      ];
                  </code></pre>
              </div>
            </details>

            <!-- Bloque para Integración y Routing -->
            <details class="component-card" open>
              <summary class="component-header">
                <h3>Integración (monitoring-routing.module.ts, monitoring.module.ts)</h3>
              </summary>
              <div class="component-body">
                  <h4>Análisis General</h4>
                  <p>
                    Conexión del nuevo componente al ecosistema de la aplicación, definiendo rutas y cargando los módulos necesarios.
                  </p>
                  
                  <h4>Cambios Detallados</h4>
            
                  <h5>Enrutamiento</h5>
                  <p><b>Explicación:</b> Se añade la ruta <code>latencias</code> bajo el componente padre de monitoreo, heredando el layout base.</p>
                  <b>Código Nuevo:</b>
                  <pre><code class="language-typescript">
children: [
        { path: 'deadletter', component: MonitoringComponent },
        { path: 'latencias', component: LatenciasComponent } // Nueva ruta
      ]
                  </code></pre>
              </div>
            </details>

            <!-- Bloque para Gestión de Accesos -->
            <details class="component-card" open>
              <summary class="component-header">
                <h3>Gestión de Accesos (user.component.ts, pages.component.ts)</h3>
              </summary>
              <div class="component-body">
                  <h4>Análisis General</h4>
                  <p>
                    Se visibiliza la funcionalidad en el menú lateral y se protege mediante el sistema de permisos de usuario.
                  </p>
                  
                  <h4>Cambios Detallados</h4>
            
                  <h5>Definición de Permiso</h5>
                  <p><b>Explicación:</b> Se registra el permiso "Latencias" en el gestor de usuarios, permitiendo habilitar/deshabilitar el acceso al dashboard según el rol.</p>
                  <b>Código Nuevo:</b>
                  <pre><code class="language-typescript">
{
      permission: "Latencias",
      value: "/api/monitoring",
      check: false,
      tabPosition: 1
    },
                  </code></pre>
                  
                  <div class="analysis-box">
                  <h4>Conclusión del análisis</h4>
                  <p><b>Arquitectura:</b> El procesamiento de datos en el frontend reduce la carga del servidor.<br>
                  <b>Seguridad:</b> La funcionalidad nace protegida por el esquema de permisos existente.<br>
                  <b>Visibilidad:</b> Provee una herramienta gráfica potente para diagnosticar problemas de rendimiento en tiempo real.</p>
                </div>
              </div>
            </details>

        </section>
    </div>

    <!-- Scripts de Prism.js para resaltar código -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

</body>
</html>
