<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notas de Release: Concentrador 8.5.3 - Segmentación por Plataforma</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />

    <style>
        /* Importación de Fuentes de Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Fira+Code:wght@400&display=swap');

        /* Variables CSS para la Paleta de Colores */
        :root {
            --bg-color: #f4f7f9;
            --card-bg-color: #ffffff;
            --text-color: #212529;
            --text-muted-color: #6c757d;
            --border-color: #dee2e6;
            --primary-color: #0056b3;
            --analysis-bg: #e6f7ff;
            --analysis-border: #91d5ff;
            --deployment-bg: #f0fdf4;
            --deployment-border: #86efac;
        }

        /* Estilos Base */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 2em;
            line-height: 1.7;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
        }

        /* Encabezado Principal */
        .main-header {
            background-color: var(--card-bg-color);
            padding: 2em;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin-bottom: 2.5em;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .main-header h1 {
            margin: 0 0 0.25em 0;
            font-size: 2.2em;
            color: var(--primary-color);
        }

        .main-header p {
            margin: 0;
            font-size: 1.1em;
            color: var(--text-muted-color);
        }

        /* Información de Despliegue */
        .deployment-info-box {
            background-color: var(--deployment-bg);
            border-left: 4px solid var(--deployment-border);
            padding: 1em 1.5em;
            margin-bottom: 2.5em;
            border-radius: 4px;
        }

        .deployment-info-box h4 {
            margin-top: 0;
            font-size: 1.2em;
            color: #166534;
        }

        .deployment-info-box p {
            margin: 0.5em 0 0 0;
            font-family: 'Fira Code', monospace;
            font-size: 0.95em;
        }

        /* Secciones de Servicio */
        .service-section {
            margin-bottom: 3em;
        }

        .service-section>h2 {
            font-size: 1.8em;
            color: var(--primary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5em;
            margin-bottom: 1.5em;
        }

        /* Tarjeta de Componente (details) */
        .component-card {
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 2em;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        /* Encabezado de la Tarjeta (summary) */
        .component-header {
            padding: 1em 1.5em;
            background-color: #fafafa;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            list-style: none; /* Oculta el marcador de triángulo por defecto */
        }

        /* Oculta el marcador de triángulo en WebKit (Chrome/Safari) */
        .component-header::-webkit-details-marker {
            display: none;
        }

        .component-header h3 {
            margin: 0;
            font-family: 'Fira Code', monospace;
            font-size: 1.2em;
        }

        /* Cuerpo de la Tarjeta */
        .component-body {
            padding: 1.5em;
        }

        .component-body h4 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            font-size: 1.2em;
            color: #343a40;
        }

        .component-body h5 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            font-size: 1.1em;
            font-weight: 700;
        }

        /* Caja de Conclusión del Análisis */
        .analysis-box {
            background-color: var(--analysis-bg);
            border-left: 4px solid var(--analysis-border);
            padding: 1em 1.5em;
            margin-top: 1.5em;
            border-radius: 4px;
        }

        .analysis-box h4 {
            margin-top: 0;
            font-size: 1.1em;
            color: var(--primary-color);
        }

        /* --- CSS PARA BLOQUES DE CÓDIGO --- */
        .component-body pre {
            padding: 1.2em !important;
            margin: 1em 0 !important;
            border-radius: 6px;
            font-family: 'Fira Code', monospace !important;
            font-size: 0.9em !important;
            line-height: 1.5 !important;
            border: 1px solid var(--border-color);
            background-color: #2d2d2d; 
            color: #ccc;
            white-space: pre-wrap !important;
            overflow-wrap: break-word !important;
        }

        .component-body pre code {
            font-family: 'Fira Code', monospace !important;
            white-space: pre-wrap !important;
        }
    </style>
</head>

<body>

    <div class="container">
        <header class="main-header">
            <h1>Notas de Release: Concentrador 8.5.3</h1>
            <p>
                Granularidad por Plataforma y Estandarización UTC en Métricas.
            </p>
        </header>

        <div class="deployment-info-box">
            <h4>Información de Despliegue</h4>
            <p><b>Versión:</b> 8.5.3</p>
            <p><b>Fecha de Despliegue:</b> 03/02/2026</p>
            <p><b>AWS Task:</b> 264</p>
            <p><b>Commits:</b> bdbe7e218ddced4cc9ba20d18f2a3611471e1aa8</p>
        </div>

        <section id="summary" class="service-section">
            <h2>Resumen General de la Versión</h2>
            <p>
                Esta actualización representa una mejora sustancial en la analítica de rendimiento del sistema. Se ha profundizado el nivel de detalle en el cálculo de promedios de tiempos, permitiendo desglosar las latencias por plataforma específica (ej. PedidosYa vs Rappi). Además, se ha estandarizado todo el manejo de fechas a UTC para garantizar la consistencia de los reportes diarios independientemente de la zona horaria del servidor.
            </p>
        </section>

        <section id="technical-analysis" class="service-section">
            <h2>Análisis Técnico Detallado</h2>

            <!-- Bloque para api/src/utils/initialData.js -->
            <details class="component-card" open>
              <summary class="component-header">
                <h3>api/src/utils/initialData.js</h3>
              </summary>
              <div class="component-body">
                  <h4>Análisis General</h4>
                  <p>
                    El archivo ha evolucionado de un cálculo estadístico general a uno dinámico y segmentado. La inclusión del <code>platformId</code> transforma la métrica en un instrumento de diagnóstico preciso por socio comercial.
                  </p>
                  
                  <h4>Cambios Detallados</h4>
            
                  <h5>Estandarización a Tiempo Universal (UTC)</h5>
                  <p><b>Explicación:</b> Se reemplazan los métodos de fecha locales por métodos UTC (<code>setUTCDate</code>, <code>setUTCHours</code>). Esto evita errores de cálculo en los límites del día causados por zonas horarias o cambios de hora estacionales.</p>
                  
                  <b>Código Antes:</b>
                  <pre><code class="language-javascript">
const start = new Date();
start.setDate(start.getDate() - 1);
start.setHours(0, 0, 0, 0);
                  </code></pre>
                  
                  <b>Código Después:</b>
                  <pre><code class="language-javascript">
const start = new Date();
start.setUTCDate(start.getUTCDate() - 1);
start.setUTCHours(0, 0, 0, 0);
                  </code></pre>

                  <h5>Segmentación por Plataforma y Mapeo Dinámico</h5>
                  <p><b>Explicación:</b> Se modifica la estructura de agrupación ("buckets"). En lugar de iterar solo por Hora y Cloud, se detectan dinámicamente las plataformas activas en el periodo y se genera un desglose <code>Hora-Cloud-PlatformId</code>.</p>

                  <b>Código Antes:</b>
                  <pre><code class="language-javascript">
const buckets = {};
for (let h = 0; h < 24; h++) {
  for (const cloud of [true, false]) {
    const key = `${h}-${cloud}`;
    buckets[key] = { /* ... */ };
  }
}
                  </code></pre>
                  
                  <b>Código Después:</b>
                  <pre><code class="language-javascript">
const platformMap = {};
const platformIds = new Set();
// ... lógica para poblar platformIds desde los datos ...

const buckets = {};
for (let h = 0; h < 24; h++) {
  for (const cloud of [true, false]) {
    for (const platformId of platformIds) {
      const key = `${h}-${cloud}-${platformId}`;
      buckets[key] = {
        hour: h,
        cloud,
        platformId,
        platform: platformMap[platformId],
        // ...
      };
    }
  }
}
                  </code></pre>
                  
                  <div class="analysis-box">
                  <h4>Conclusión del análisis</h4>
                  <p><b>Precisión:</b> Permite identificar qué plataforma específica está sufriendo latencia.<br>
                  <b>Consistencia:</b> El uso de UTC elimina ambigüedades en la ejecución programada.<br>
                  <b>Escalabilidad:</b> El sistema se adapta automáticamente a nuevas plataformas sin cambios de código.</p>
                </div>
              </div>
            </details>

        </section>
    </div>

    <!-- Scripts de Prism.js para resaltar código -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

</body>
</html>
